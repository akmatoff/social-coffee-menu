---
import RootLayout from "../layouts/RootLayout.astro";
import MenuComponent from "../components/Menu.astro";
import getCategories from "../api/getCategories";
import { CategoryType } from "../types";

const searchParams = Astro.url.searchParams;

const language = searchParams.get("lang") || "ru";

const categories = await getCategories(language);

const { menu } = Astro.params;

const menus = categories.filter(
  (category) => category.category_type === CategoryType.MENU
);

const activeMenu =
  categories.find((category) => category.slug === menu) || menus?.[0];
---

<RootLayout categories={categories}>
  <MenuComponent categories={activeMenu.subcategories} />
</RootLayout>
